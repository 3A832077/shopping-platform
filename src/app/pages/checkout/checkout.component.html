<nz-steps [nzCurrent]="current" nzSize="small">
  <nz-step nzTitle="確認商品" nzDescription="檢查訂單內容"></nz-step>
  <nz-step nzTitle="寄送方式" nzDescription="選擇寄送方式"></nz-step>
  <nz-step nzTitle="付款方式" nzDescription="選擇付款方式"></nz-step>
  <nz-step nzTitle="完成訂單" nzDescription="訂單已送出"></nz-step>
</nz-steps>

<div class="steps-content mt-4">
  @switch (current) {
    @case (0) {
      <div class="col-12">
        <div class="bg-white rounded p-4 shadow-sm">
          <h5 class="fw-bold mb-3">訂單摘要</h5>
          @for (item of cartItems; track $index) {
            <div class="d-flex justify-content-between mb-2">
              <span>{{ item.products.name }} ({{ item.quantity }})</span>
              <span>${{ item.products.price }}</span>
            </div>
          }
          <div class="d-flex justify-content-between">
            <span>小計</span>
            <span>${{ total }}</span>
          </div>
          <div class="d-flex justify-content-between">
            <span>運費</span>
            <span>$0</span>
          </div>
          <hr />
          <div class="d-flex justify-content-between fw-bold">
            <span>預估總金額</span>
            <span>${{ total }}</span>
          </div>
        </div>
      </div>
    }
    @case (1) {
      <div class="col-12">
        <p>請選擇您的寄送方式：</p>
        <nz-radio-group [(ngModel)]="shippingMethod">
          <label nz-radio nzValue="home">宅配</label>
          <label nz-radio nzValue="711">7-11取貨</label>
        </nz-radio-group>
        @switch (shippingMethod) {
          @case ('home') {
            <div class="mt-4">
              <form nz-form [formGroup]="form">
                <div class="row g-3 mb-3">
                  <div class="col-12 col-md-4">
                    <nz-form-item>
                      <nz-form-control>
                        <input formControlName="name" nz-input placeholder="請輸入姓名" />
                      </nz-form-control>
                    </nz-form-item>
                  </div>

                  <div class="col-12 col-md-4">
                    <nz-form-item>
                      <nz-form-control>
                        <nz-select nzPlaceHolder="選擇城市" (ngModelChange)="getArea($event)" formControlName="city" nzAllowClear nzShowSearch>
                          @for (item of cities; track $index) {
                            <nz-option [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                          }
                        </nz-select>
                      </nz-form-control>
                    </nz-form-item>
                  </div>

                  <div class="col-12 col-md-4">
                    <nz-form-item>
                      <nz-form-control>
                        <nz-select nzPlaceHolder="選擇區域" formControlName="area" nzAllowClear nzShowSearch>
                          @for (item of areaList; track $index) {
                            <nz-option [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                          }
                        </nz-select>
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>

                <div class="row g-3 mb-3">
                  <div class="col-12">
                    <nz-form-item>
                      <nz-form-control>
                        <input formControlName="address" nz-input placeholder="請輸入詳細地址" />
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>

                <div class="row g-3 mb-3">
                  <div class="col-12 col-md-6">
                    <nz-form-item>
                      <nz-form-control>
                        <input formControlName="phone" nz-input placeholder="請輸入聯絡電話" />
                      </nz-form-control>
                    </nz-form-item>
                  </div>
                </div>
              </form>
            </div>
          }
          @case ('711') {
              <form [formGroup]="form">
                <div class="row g-3 mt-2">
                  <div class="col-12 col-md-4">
                    <nz-form-item>
                      <nz-form-control>
                        <nz-select nzPlaceHolder="選擇城市" (ngModelChange)="getArea($event)" formControlName="city" nzAllowClear nzShowSearch>
                          @for (item of cities; track $index) {
                            <nz-option [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                          }
                        </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                  </div>
                  <div class="col-12 col-md-4">
                    <nz-form-item>
                      <nz-form-control>
                        <nz-select nzPlaceHolder="選擇區域" formControlName="area" nzAllowClear nzShowSearch
                          (ngModelChange)="getStore(form.value.city, $event)">
                        @for (item of areaList; track $index) {
                          <nz-option [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                        }
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div class="col-12 col-md-4">
                  <nz-form-item>
                    <nz-form-control>
                      <nz-select nzPlaceHolder="選擇取貨門市" formControlName="store" nzAllowClear nzShowSearch>
                        @for (item of storeList; track $index) {
                          <nz-option [nzValue]="item.id" [nzLabel]="item.name"></nz-option>
                        }
                      </nz-select>
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
              <div class="row g-3 mb-3">
                <div class="col-12 col-md-6">
                  <nz-form-item>
                    <nz-form-control>
                      <input formControlName="name" nz-input placeholder="請輸入姓名" />
                    </nz-form-control>
                  </nz-form-item>
                </div>
                <div class="col-12 col-md-6">
                  <nz-form-item>
                    <nz-form-control>
                      <input formControlName="phone" nz-input placeholder="請輸入聯絡電話" />
                    </nz-form-control>
                  </nz-form-item>
                </div>
              </div>
            </form>
            <div class="mt-3">
              <p>門市地址: {{ storeList[getSelectedStoreIndex()]?.address || '--' }}</p>
            </div>
          }
        }
      </div>
    }
    @case (2) {
      <div class="col-12">
        <p>請選擇您的付款方式：</p>
        <nz-radio-group [(ngModel)]="payMethod">
          <label nz-radio nzValue="credit">信用卡</label>
          <label nz-radio nzValue="cash">貨到付款</label>
        </nz-radio-group>
        @if (payMethod === 'credit') {
          <div class="mt-4">
            <form nz-form [formGroup]="form">
              <nz-form-item>
                <nz-form-control>
                  <input formControlName="cardNumber" nz-input placeholder="信用卡號" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-control>
                  <input formControlName="cardHolder" nz-input placeholder="持卡人姓名" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-control>
                  <input formControlName="expiryDate" nz-input placeholder="有效期限 (MM/YY)" />
                </nz-form-control>
              </nz-form-item>
              <nz-form-item>
                <nz-form-control>
                  <input formControlName="cvv" nz-input placeholder="CVV" />
                </nz-form-control>
              </nz-form-item>
            </form>
          </div>
        }
      </div>
    }
    @case (3) {
      <nz-result nzStatus="success" nzTitle="訂單已成功送出！">
        <div nz-result-extra>
          <button matButton routerLink="/order">查看訂單</button>
          <button matButton routerLink="/home">繼續購物</button>
        </div>
      </nz-result>
    }
  }
</div>
<div class="steps-action mt-4 text-end">
  @if (current > 0) {
    <button matButton (click)="prev()">
      <span>上一步</span>
    </button>
  }
  @if (current < 2) {
    <button matButton (click)="next()">
      <span>下一步</span>
    </button>
  }
  @if (current === 2) {
    <button matButton (click)="next()">
      <span>完成訂單</span>
    </button>
  }
</div>
